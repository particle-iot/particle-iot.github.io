<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<html style="height:100%;">

<head>
    <!-- CSS only -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css"
        integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">
</head>

<body style="height:100%;">
    <div style="padding-top: 20px;"><p style="font-size: large; font-weight: bold; text-align: center;">There is a new calculator <a href="https://docs.particle.io/tools/developer-tools/battery-calculator/">available here</a>
        that has more options and should be used instead of this calculator.</p></div>
    <div class="container-fluid d-flex flex-column" style="height:100%;">
        <div class="row justify-content-center pt-3 flex-shrink-1">
            <div class="col-md-10 ">
                <div class="font-weight-bold text-center">Device</div>
                <div>T402: North America Cat-M1<br />T523: Europe Cat 1</div>
                <select class="form-select" name="device" id="device"></select>
            </div>
        </div>
        <div class="row justify-content-center pt-3 flex-shrink-1">
            <div class="col-md-10">
                <div class="text-center font-weight-bold">Sleep Mode</div>
                <span class="font-weight-bold">Ultra Low Power:</span> used by off the shelf firmware and Tracker
                Services. If
                using configuration on the Particle Console/API to configure Sleep modes, select Ultra Low Power. <br />
                If the "Motion" options of the configuration are disabled, then select "RTC wake-up," otherwise
                "RTC+motion wake-up"
                <div class="pt-3"><span class="font-weight-bold">Stop:</span> Available if using custom firmware
                    application, allows for additional wake-up sources. Highest power consumption.</div>
                <div class="pt-3"><span class="font-weight-bold">Hibernate:</span> Available if using custom firmware
                    application. Lowest power consumption. Application will have to restore state like local variables.
                    This should be treated as a cold re-start.</div>
                <select class="form-select" name="sleepMode" id="sleepMode"></select>
            </div>
        </div>
        <div class="row justify-content-center pt-3 flex-shrink-1">
            <div class="col-md-10">
                <div class="text-center font-weight-bold">Battery</div>
                Select the battery capacity and type. If using the Tracker ONE, leave as 2000mAh and LiPo.
            </div>
            <div class="col-md-5">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Capacity</span>
                    </div>
                    <input class="form-control" type="number" min="100" max="99999" value="2000" id="batteryCap"
                        aria-describedby="batteryCapUnits" />
                    <span class="input-group-text" id="batteryCapUnits">mAh</span>
                </div>
            </div>
            <div class="col-md-5">
                <select class="form-select" name="batteryChemistry" id="batteryChemistry"></select>
            </div>
        </div>
        <div class="row justify-content-center pt-3 flex-shrink-1">
            <div class="col-md-3">
                <div class="text-center font-weight-bold">Publishes per day</div>
                <div>How many times does the device wake up, connect to the network, and publish?</div>
                <input class="form-control" type="number" min="0" value="1" id="publishes" max="999" />
            </div>
            <div class="col-md-3">
                <div class="text-center font-weight-bold">Time from boot to publish</div>
                <div>Worse cellular reception or longer time to GPS lock will make this longer. You can set a maximum as
                    a timeout.</div>
                <div class="input-group">
                    <input class="form-control" type="number" min="30" max="999" value="90" id="conn_max"
                        aria-describedby="conn_maxUnits" />
                    <span class="input-group-text" id="conn_maxUnits">seconds</span>
                </div>
            </div>
            <div class="col-md-3">
                <div class="text-center font-weight-bold">Execution time after publish</div>
                <div>This is configured in the console, to allow the application to clean up after publish.</div>
                <div class="input-group">
                    <input class="form-control" type="number" min="10" max="99" value="10" id="exe_min"
                        aria-describedby="exe_minUnits" />
                    <span class="input-group-text" id="exe_minUnits">seconds</span>
                </div>
            </div>
        </div>
        <div class="row justify-content-center pt-3 flex-shrink-1">
            <div class="col-md-10">
                <div class="font-weight-bold text-center">Partial wake-ups</div>
                These are wake-ups when the cellular modem is not turned on. The device may collect data, and then goes
                back into sleep mode.
            </div>
            <div class="col-md-5">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Per day</span>
                    </div>
                    <input class="form-control" type="number" min="0" value="0" id="partialWake" max="999" />
                </div>
            </div>
            <div class="col-md-5">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Duration</span>
                    </div>
                    <input class="form-control" type="number" min="1" value="10" id="partialWakeTime" max="999"
                        aria-describedby="partialWakeTimeUnits" />
                    <span class="input-group-text" id="partialWakeTimeUnits">seconds</span>
                </div>
            </div>
        </div>
        <div class="row p-5 mt-2 flex-fill text-white"
            style="background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAABYBAMAAACqvNKAAAAAIVBMVEX///////////8AAAD///////////////////////////911Zr4AAAAC3RSTlMKBwEAAwYFAgkIBMMtOqQAAAHWSURBVHgB7daBhxtBFAbwl5K0DiSFO8CdlSsHYr+0WwdKIAVG/oK4wAEaCwJIndKA0uNywLrC6F/Zftvu57nMFAWQAUl+K/Pe5H2btV6B5PoQbDRI2vpLsNXmLiHjQbG0FeYPB3LZL0Aql6fP5GpboyWUYeEB08cZ/hKq4Y2T6uwJIlT7maQMN3CE6de6k+UCjlhT74+VsatJhHG/bf3jPQ4Iax7LelckCJu7N2NygjC3PiVFlX1HhjCssxSRpSO9zlAV7CRD74f2apamprGf2zpFm925cb5FPg4T46iIfBxIioqIA0vSwIqqsx8gacxFfCdq4yBqTuEI19u6IwbYEy45t6SLk+IZsQWSunTEFqLLmSO2EFmOJ1n45jPtCdf2AhmaW69O03p366LniGXH35wgnkdsW/CkU4xtC4502iSUwydHupaE6nEGkXYgcddCpLqiZqYjvhTpJyNd9SieuAGJ90xHKmtiKtYTW5iYLZAgTPefrI8k4byxlxl6G/4nsEe6zVJpqxy9s88ZqvYj5UukAW5vJp7cACvLIg0wo+RIU6nR9aQPdJGIX6MVH0TaHCpI5EuG0kdiQ1pKL6ls/L+AMk+a3x9IW9fSRjuk1sUg/ONh6RfZZgygDmWfggAAAABJRU5ErkJggg=='), linear-gradient(175deg, rgb(14, 84, 138) 0%, rgb(10, 66, 114) 16%, rgb(7, 49, 91) 39%, rgb(4, 30, 65) 72%)">
            <div class="row">
                <div class="col-md d-none d-md-block">
                    <div style='width: 200px;'><svg viewBox="0 0 3849.5 890" xmlns="http://www.w3.org/2000/svg">
                            <g fill="#fff">
                                <path
                                    d="M1123.6,105.5H1332c149,0,251.5,76.7,251.5,207.9v1.9c0,142.8-122.9,216.6-264.1,216.6h-145.6v253.5h-50.3V105.5z M1322.4,485.3c125.8,0,210.9-66.1,210.9-167.1v-1.9c0-107.8-83.2-164.2-205.1-164.2h-154.3v333.2H1322.4z">
                                </path>
                                <path
                                    d="M1599.3,641.2v-1.9c0-102.9,88.3-161.1,216.4-161.1c68.9,0,116.4,8.7,164,21.3v-21.3c0-100-61.1-151.4-163-151.4 c-60.2,0-109.7,16.5-155.3,39.8l-17.5-41.7c54.3-25.2,107.7-42.7,175.6-42.7c67,0,120.3,18.4,156.2,54.3c33,33,50.5,78.6,50.5,139.7 v308.6h-46.6v-82.5c-34,47.5-95.1,94.1-189.2,94.1C1698.3,796.5,1599.3,744.1,1599.3,641.2z M1980.7,599.5v-56.3 c-41.7-10.7-97-22.3-167.9-22.3c-104.8,0-163,46.6-163,115.5v1.9c0,71.8,67.9,113.5,143.6,113.5 C1894.3,751.9,1980.7,689.7,1980.7,599.5z">
                                </path>
                                <path
                                    d="M2087.5,290.6h47.5v140.7c38.8-88.3,145.4-140.2,243.7-140.2v44.1h-4.8c-114.5,0-238.9,86.4-238.9,247.4v202.8h-47.5V290.6z">
                                </path>
                                <path
                                    d="M2438.8,290V131.8h47.6V290H2660v43.7h-173.7v319.2c0,70.8,41.7,96.1,99,96.1c24.3,0,44.6-4.9,72.8-17.5v44.6 c-25.2,11.6-49.5,17.5-80.5,17.5c-76.7,0-138.8-41.7-138.8-135.9V333.6">
                                </path>
                                <path
                                    d="M2809.6,545.4v-1.9c0-135.5,107.6-253,245.5-253c90.6,0,147.3,41.7,192.6,89.1l-33,34.1c-41.5-42.6-88.8-79.6-160.5-79.6 c-109.5,0-194.5,91.9-194.5,207.5v1.9c0,116.5,87.8,209.4,198.3,209.4c68,0,120.9-35.1,161.5-80.5l32.1,28.4 c-49.1,55.9-107.6,95.7-196.4,95.7C2916.3,796.5,2809.6,680.9,2809.6,545.4z">
                                </path>
                                <path d="M3302.6,77.5h48v708h-48V77.5z"></path>
                                <path
                                    d="M3399.8,544.5v-1.9c0-140.2,98.3-252,228.6-252c135.1,0,221.1,109.9,221.1,253c0,8.5,0,11.4-1,18.9h-399.6 c8.5,120.3,94.5,190.4,188.9,190.4c74.6,0,125.6-33.2,165.3-75.8l32.1,28.4c-49.1,53.1-106.7,91-199.3,91 C3509.4,796.5,3399.8,695.1,3399.8,544.5z M3799.4,520.8c-6.6-97.6-62.3-187.6-172.9-187.6c-95.4,0-169.1,80.5-177.6,187.6H3799.4z">
                                </path>
                                <g>
                                    <rect x="2712.6" y="289.9" width="48" height="495.6"></rect>
                                    <rect x="2712.6" y="131.5" width="48" height="78.4"></rect>
                                </g>
                            </g>
                            <g fill="#00aeef">
                                <polygon points="890,445 653.1,495.9 620.2,445 653.1,394.1"></polygon>
                                <polygon
                                    points="759.7,130.3 556.2,445 759.7,759.6 445,556.2 130.3,759.6 333.8,445 130.3,130.3 445,333.7">
                                </polygon>
                                <polygon points="445,620.2 495.9,653.1 445,890 394.1,653.1"></polygon>
                                <polygon points="445,0 495.9,236.9 445,269.8 394.1,236.9"></polygon>
                                <polygon points="236.9,394.1 269.8,445 236.9,495.9 0,445"></polygon>
                            </g>
                        </svg></div>
                </div>
                <div class="col-md">
                    <div class="row justify-content-center"><span class="text-center font-weight-bold">Estimated battery
                            life</span>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col text-center">
                            <span id="days"></span><span class="font-weight-light"> days</span>
                        </div>
                    </div>
                    <div class="row justify-content-center ">
                        <div class="col text-center">
                            <span id="weeks"></span><span class="font-weight-light"> weeks</span>
                        </div>
                    </div>
                </div>
                <div class="col-md"></div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        {
        const dataDb = [
            {
                "name":"T402", 
                "wakeToPublish":110,
                "publishToSleep":20,
                "partialWake":10,
                "sleepModes": [
                    {"name":"Ultra Low Power: RTC wake-up","power":0.117},
                    {"name":"Ultra Low Power: RTC+motion wake-up","power":0.158},
                    {"name":"Ultra Low power: RTC+BLE wake-up","power":0.186},
                    {"name":"Ultra Low power: RTC+UART wake-up","power":0.530},
                    {"name":"Hibernate: RTC wake-up","power":0.103},
                    {"name":"Hibernate: RTC+motion wake-up","power":0.137}
                ]
            },
            {
                "name":"T523",
                "wakeToPublish":137,
                "publishToSleep":24,
                "partialWake":10,
                "sleepModes": [
                    {"name":"Ultra Low Power: RTC wake-up","power":0.140},
                    {"name":"Ultra Low Power: RTC+motion wake-up","power":0.191},
                    {"name":"Ultra Low power: RTC+BLE wake-up","power":0.214},
                    {"name":"Ultra Low power: RTC+UART wake-up","power":0.564},
                    {"name":"Hibernate: RTC wake-up","power":0.111},
                    {"name":"Hibernate: RTC+motion wake-up","power":0.163}
                ]
            }
        ]
        const batteryChems = [
            {
                "name":"LiPo: Rechargeable, one year self-discharge (Tracker One)",
                "days": 360
            },
            {
                "name":"Lithium Ferrum: Non-rechargeable, 10 year self-discharge",
                "days": 3600
            }
        ]
        const deviceSelect = document.getElementById("device");
        const sleepModeSelect = document.getElementById("sleepMode");
        const batteryCap = document.getElementById("batteryCap");
        const batteryChemistry = document.getElementById("batteryChemistry");
        const publishes = document.getElementById("publishes");
        const partialWake = document.getElementById("partialWake");
        const partialWakeTime = document.getElementById("partialWakeTime");
        const conn_max = document.getElementById("conn_max");
        const exe_min = document.getElementById("exe_min");

        dataDb.forEach( element => {
            let option = document.createElement("option");
            option.text = option.value = element.name;
            deviceSelect.add(option);
        });
        batteryChems.forEach( element => {
            let option = document.createElement("option");
            option.text = element.name;
            option.value = element.days;
            batteryChemistry.add(option);
        })
        const deviceChanged = () => {
            sleepModeSelect.querySelectorAll("option").forEach(option => option.remove());
            for (let element of dataDb) {
                if (element.name == deviceSelect.value) {
                    element.sleepModes.forEach( modes => {
                        let option = document.createElement("option");
                        option.text = modes.name;
                        option.value = modes.power;
                        sleepModeSelect.add(option);
                    });
                    break;
                }
            };
            console.log(deviceSelect.value);
            calculateFunc();
        };
        const calculateFunc = () => {
            let selfDischargePerDay = batteryCap.value*0.9/batteryChemistry.value;
            let sleepPowerPerDay, publishPowerPerDay, partialPowerPerDay;
            for (let element of dataDb) {
                if (element.name == deviceSelect.value) {
                    sleepPowerPerDay = (24-(publishes.value*(conn_max.valueAsNumber+exe_min.valueAsNumber)/3600)-(partialWake.valueAsNumber*partialWakeTime.valueAsNumber/3600))*sleepModeSelect.value;
                    publishPowerPerDay = (publishes.value*(conn_max.valueAsNumber)/3600)*element.wakeToPublish+(publishes.value*(exe_min.valueAsNumber)/3600)*element.publishToSleep;
                    partialPowerPerDay = (partialWake.valueAsNumber*partialWakeTime.valueAsNumber*element.partialWake)/3600;
                    break;
                }
            }
            let batteryLife = batteryCap.value*0.9/(selfDischargePerDay+(sleepPowerPerDay+publishPowerPerDay+partialPowerPerDay)/0.85);
            console.log("Partial Power per day: "+partialPowerPerDay);
            console.log("Sleep Power Per Day: "+sleepPowerPerDay);
            console.log("Publish Power Per Day: "+publishPowerPerDay);
            console.log("Self discharge per day: "+selfDischargePerDay);
            document.getElementById("days").innerText = batteryLife.toFixed(2);
            document.getElementById("weeks").innerText = (batteryLife/7).toFixed(2);
        }
        deviceSelect.addEventListener('change', deviceChanged);
        sleepModeSelect.addEventListener('change', () => calculateFunc());
        publishes.addEventListener('change', () => calculateFunc());
        partialWake.addEventListener('change', () => calculateFunc());
        partialWakeTime.addEventListener('change', () => calculateFunc());
        batteryCap.addEventListener('change', () => calculateFunc());
        batteryChemistry.addEventListener('change', () => calculateFunc());
        conn_max.addEventListener('change', () => calculateFunc());
        exe_min.addEventListener('change', () => calculateFunc());
        deviceChanged();
        }
    </script>
</body>
</html>